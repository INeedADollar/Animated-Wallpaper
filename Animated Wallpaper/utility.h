#ifndef UTILITY_H
#define UTILITY_H

#include <windows.h>

#include <QFile>
#include <QProcess>

#define FW(x,y) FindWindowEx(x, NULL, y, L"")

#define ORIGINALARR "4d5a90000300000004000000ffff0000b8000000000000004000000000000000000000000000000000000000000000000000000000000000000000008" \
                    "00000000e1fba0e00b409cd21b8014ccd21546869732070726f6772616d2063616e6e6f742062652072756e20696e20444f53206d6f64652e0d0d0a24" \
                    "000000000000005045000064860a00428f785f0000000000000000f0002f020b02021e0096010000180600000a0000b01400000010000000004000000" \
                    "000000010000000020000040000000000000005000200000000000090060000040000e9fe060002000000000020000000000000100000000000000000" \
                    "10000000000000100000000000000000000010000000000000000000000000800400388a000000300500e050010000300400cc0f00000000000000000" \
                    "000000000000000000000000000000000000000000000000000000000000000000080fa03002800000000000000000000000000000000000000d49404" \
                    "00801300000000000000000000000000000000000000000000000000002e7465787400000030950100001000000096010000040000000000000000000" \
                    "000000000600050602e64617461000000e003000000b0010000040000009a0100000000000000000000000000400060c02e72646174610000c8620200" \
                    "00c0010000640200009e0100000000000000000000000000400060402e70646174610000cc0f000000300400001000000002040000000000000000000" \
                    "0000000400030402e786461746100001c260000004004000028000000120400000000000000000000000000400030402e62737300000000c009000000" \
                    "7004000000000000000000000000000000000000000000800060c02e69646174610000388a000000800400008c0000003a04000000000000000000000" \
                    "00000400030c02e4352540000000068000000001005000002000000c60400000000000000000000000000400040c02e746c7300000000100000000020" \
                    "05000002000000c80400000000000000000000000000400040c02e72737263000000e0500100003005000052010000ca0400000000000000000000000" \
                    "000400030c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000" \
                    "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000" \
                    "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000" \
                    "0000000000000000000000000000000000000000000000000000000000000000"


HRESULT CreateLink(LPCWSTR, LPCSTR, LPCWSTR);
bool IsApplicationInstanceAlreadyRunning();
void CreateAWProcess();
void CreateExplorerThreadListener();
void NotifyMainWindow();
QByteArray readFirst1000Bytes(QFile &);
void AskForShortcut();
void handleProcessTermination(int, QProcess::ExitStatus);
void handleProcessError(QProcess::ProcessError);

extern QProcess *AWProcess;
extern const QByteArray origAr;

struct TRAYDATA
{
    HWND hwnd;
    UINT uID;
    UINT uCallbackMessage;
    DWORD Reserved[2];
    HICON hIcon;
};

#endif // UTILITY_H
